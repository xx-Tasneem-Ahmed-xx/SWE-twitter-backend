name: Enforce Pull Request Workflow

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: write 
  pull-requests: read

jobs:
  enforce-pr-policy:
    runs-on: ubuntu-latest

    steps:
      - name: üö´ Block direct pushes to main
        if: github.event_name == 'push'
        run: |
          echo "‚ùå Direct push to 'main' detected!"
          echo "All changes to main must go through a Pull Request."
          echo "Reverting this unauthorized push..."
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Action"
          git clone https://github.com/${{ github.repository }} repo
          cd repo
          git revert -m 1 HEAD --no-edit || true
          git push origin main --force
          echo "üßπ Unauthorized commit reverted automatically."
          exit 1

      - name: ‚úÖ Allow PR merges
        if: github.event_name == 'pull_request'
        run: |
          echo "‚úÖ Pull Request detected ‚Äî merge allowed!"
